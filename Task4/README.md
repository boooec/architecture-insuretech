**Реализация агрегатора ОСАГО и его хранилища данных**

**Необходимость хранилища данных**  
Хранилище данных требуется для хранения промежуточных данных о заявках и ответах от страховых компаний, поскольку взаимодействие между компонентами системы осуществляется асинхронно.

**Интеграция с core-app и API**  
Для интеграции между core-app и агрегатором ОСАГО используется Event-Driven подход через Kafka, что исключает необходимость в REST API. Такой подход значительно повышает отказоустойчивость системы и улучшает ее масштабируемость.

**Процесс обработки заявок**  

1. core-app публикует заявку в Kafka Topic (osago-requests).  
2. Агрегатор ОСАГО получает заявку, обрабатывает её и публикует ответ в osago-responses.  
3. core-app получает ответ и передает его в веб-приложение через WebSocket для отображения в реальном времени.

**Отказоустойчивость**  

- Использование Kafka обеспечивает асинхронную передачу сообщений и предотвращает потерю данных в случае сбоев.  
- Механизмы Rate Limiting и Retry защищают систему от перегрузок и временных ошибок.  
- Механизмы Timeout и Circuit Breaker применяются для работы с API страховых компаний, обеспечивая стабильность в процессе взаимодействия.

**Масштабируемость и отказоустойчивость**  

- Несколько экземпляров агрегатора ОСАГО обрабатывают заявки параллельно, с использованием Kafka и PostgreSQL для обеспечения консистентности данных.  
- Для предотвращения избыточной нагрузки используются механизмы Rate Limiting, Retry и Circuit Breaker при запросах к страховым компаниям.  
- WebSocket использует Sticky Sessions для поддержания состояния соединений и обеспечения надежности передачи данных.

**Итог**  
Система становится более устойчивой и гибкой благодаря использованию Kafka для асинхронной обработки данных, а также благодаря механизмам отказоустойчивости и масштабируемости, реализованным через Kubernetes.
